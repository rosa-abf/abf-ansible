- name: mdv | lxc_setup | start/enable cgconfig service
  service: name=cgconfig state=started enabled=yes
  sudo: true

- name: mdv | lxc_setup | start/enable cgred service
  service: name=cgred state=started enabled=yes
  sudo: true

- name: mdv | lxc_setup | autostart cgconfig service
  command: chkconfig --level 345 cgconfig on
  sudo: true

- name: mdv | lxc_setup | autostart cgred service
  command: chkconfig --level 345 cgred on
  sudo: true

- name: mdv | lxc_setup | create lxcbr0 interface
  command: brctl addbr lxcbr0
  sudo: true
  ignore_errors: yes

- name: mdv | lxc_setup | make the bridge persistent on reboot
  sudo: true
  copy: >
    src=mdv/ifcfg-lxcbr0
    dest=/etc/sysconfig/network-scripts/ifcfg-lxcbr0
    owner={{ user }}

- name: mdv | lxc_setup | ifup lxcbr0
  command: ifup lxcbr0
  sudo: true

- name: mdv | lxc_setup | enable IPv4 forwarding
  lineinfile: >
    dest=/etc/hosts
    regexp='^net.ipv4.ip_forward = 0$'
    line='net.ipv4.ip_forward = 1'
  sudo: yes
  register: restart_sysctl

- name: mdv | lxc_setup | restart sysctl
  command: sysctl -p
  sudo: true
  when: restart_sysctl|success
